I"«$<div data-note-content="" class="show-content">
          <h1>
<a target="_blank"></a>å†™åœ¨å‰é¢</h1><p>2015å¹´2æœˆï¼ŒRedis3.0.0 å‘å¸ƒï¼Œredis3.0ç‰ˆæœ¬ä¹‹åæ”¯æŒClusterï¼Œå…³äºredisé›†ç¾¤çš„ä»‹ç»ï¼Œäº†è§£è¯·çœ‹ <a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank"><u>redisä¸­æ–‡ç®€ä»‹</u></a> ã€‚ <br /> æˆ‘å‡†å¤‡åœ¨ä¸€å°linuxä¸­æ¥éƒ¨ç½²redisé›†ç¾¤ï¼Œå› ä¸ºé›†ç¾¤çš„è¿è¡Œéœ€è¦6å°æœåŠ¡æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥æˆ‘åœ¨ä¸€å°linuxæœåŠ¡ä¸Šåˆ›å»º6ä¸ªèŠ‚ç‚¹ï¼Œç”¨æ¥æ¨¡æ‹Ÿ3ä¸»3ä»è¿™ç§ä¼ªåˆ†å¸ƒå¼é›†ç¾¤ã€‚redis3.0åŠä¹‹åçš„releasesç‰ˆæœ¬ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥è®¿é—®redis.ioå®˜ç½‘ï¼Œä¸‹è½½redis.tar.gzã€‚</p><h1>
<a target="_blank"></a>é›†ç¾¤æ­å»º</h1><h2>
<a target="_blank"></a>1.ä¸‹è½½å’Œè§£åŒ…</h2><p>cd /usr/local/  <br /> wget <a href="http://download.redis.io/releases/redis-3.0.3.tar.gz" target="_blank"><u>http://download.redis.io/releases/redis-3.0.3.tar.gz</u></a>  <br /> (å¤§å®¶å¯ä»¥é€‰æ‹©è‡ªå·±æƒ³å®‰è£…çš„releasesç‰ˆæœ¬)</p><p>tar -zxvf redis-3.0.3.tar.gz  <br /> mv redis-3.0.3  redis</p><h2>
<a target="_blank"></a>2.ç¼–è¯‘å®‰è£…</h2><p>cd redis  <br /> make &amp;&amp; make install  <br />æœ‰äº›äººåœ¨è¿™é‡Œå¯èƒ½ä¼šç¢°åˆ°ä¸€ä¸ªé”™è¯¯å¯¼è‡´ç¼–è¯‘ä¸è¿‡(å¦‚ä¸‹)</p><blockquote><p>make[1]: Entering directory <code>/redis/src' <br />  CC adlist.o <br />  In file included from adlist.c:34: <br />  zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory <br />  zmalloc.h:55:2: error: #error "Newer version of jemalloc required" <br />  make[1]: *** [adlist.o] Error 1 <br />  make[1]: Leaving directory</code>/redis/srcâ€™ <br />make: <em>*</em> [all] Error 2Error 2</p></blockquote><p>åŸå› æ˜¯æ²¡æœ‰å®‰è£…jemallocå†…å­˜åˆ†é…å™¨ï¼Œå¯ä»¥å®‰è£…jemalloc æˆ– ç›´æ¥ è¾“å…¥make MALLOC=libc  &amp;&amp; make install</p><h2>
<a target="_blank"></a>3. åˆ›å»ºredisèŠ‚ç‚¹</h2><hr /><p>åœ¨ä¸€å°linuxæœåŠ¡ä¸Šåˆ›å»º6ä¸ªèŠ‚ç‚¹ï¼Œ3ä¸»3ä»ã€‚ <br />cd /usr/local/</p><p>mkdir redis_cluster   //åˆ›å»ºé›†ç¾¤ç›®å½•</p><p>mkdir 7000 7001 7002 7003 7004 7005 <br />  //åˆ†åˆ«ä»£è¡¨å…­ä¸ªèŠ‚ç‚¹    å…¶å¯¹åº”ç«¯å£ 7000 7001 7002 7003 7004 7005</p><p>ä¸‹é¢åˆ›å»º7000èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå…¶ä»–èŠ‚ç‚¹å¤§å®¶æŒ‰æ­¤ä¾‹æ“ä½œå³å¯ï¼Œ <br />cd ./7000  <br /> cp /usr/local/redis/redis.conf   ./    //æ‹·è´åˆ°å½“å‰7000ç›®å½•  <br />vi redis.conf    //ç¼–è¾‘é…ç½®  ä¸»è¦ä¿®æ”¹ä¸€ä¸‹å‡ ä¸ªå‚æ•°</p><blockquote><p>daemonize    yes                          //redisåå°è¿è¡Œ <br />pidfile  /var/run/redis_7000.pid    //pidfileæ–‡ä»¶å¯¹åº”7000 <br />  port  7000                                  //ç«¯å£7000 <br />  cluster-enabled  yes                    //å¼€å¯é›†ç¾¤   æŠŠæ³¨é‡Š#å»æ‰ <br />cluster-config-file  nodes.conf      //é›†ç¾¤çš„é…ç½®  é…ç½®æ–‡ä»¶é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆ <br />cluster-node-timeout   5000       //è¯·æ±‚è¶…æ—¶  è®¾ç½®5ç§’å¤Ÿäº† <br />appendonly   yes                        //aofæ—¥å¿—å¼€å¯   æœ‰éœ€è¦å°±å¼€å¯ï¼Œå®ƒä¼šæ¯æ¬¡å†™æ“ä½œéƒ½è®°å½•ä¸€æ¡æ—¥å¿—</p></blockquote><p>é…ç½®å¥½äº†ï¼Œå°±ç›¸åº”åœ°æŠŠè¿™ä¸ªä¿®æ”¹åçš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°7003 7004 70054 7005 7002 ç›®å½•ï¼Œæ³¨æ„è¦ä¿®æ”¹ç›‘å¬ç«¯å£port 7001 7002 7003 7004 7005ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå¯åŠ¨æœåŠ¡ï¼Œè¿›å…¥èŠ‚ç‚¹ç›®å½•  <br /> ä¾æ¬¡æ‰§è¡Œ  redis-server   redis.conf  <br />å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†appendonly.aof  nodes.conf  <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-7cdcb85e5976cfe6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-7cdcb85e5976cfe6?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p>ps -ef | grep redis æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸ  <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-4307d819ea1bded0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-4307d819ea1bded0?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p><br /></p><br /><p>netstat -tnlp | grep redis å¯ä»¥çœ‹åˆ°redisç›‘å¬ç«¯å£</p><br /><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-5510225a4415f34c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-5510225a4415f34c?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><h2>
<a target="_blank"></a>4. åˆ›å»ºé›†ç¾¤</h2><p>å‰é¢å·²ç»å‡†å¤‡å¥½äº†æ­å»ºé›†ç¾¤çš„redisèŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦æŠŠè¿™äº›èŠ‚ç‚¹éƒ½ä¸²è¿èµ·æ¥æ­å»ºé›†ç¾¤ã€‚åˆ›å»ºé›†ç¾¤éœ€è¦rubyçš„ç¯å¢ƒï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªå·¥å…·ï¼šredis-trib.rb  ï¼ˆ/usr/local/redis/src/redis-trib.rbï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—å®‰è£…ruby.</p><p>å®‰è£…rubygemsç»„ä»¶ <br />yum -y install ruby ruby-devel rubygems rpm-build</p><p>æ¥ç€ï¼ŒåŠ è½½redisï¼Œéœ€è¦rediså’Œrubyçš„æ¥å£ï¼Œä½¿ç”¨gem å®‰è£… <br />gem install redis <br />å¯æ˜¯ï¼Œæˆ‘å´å‡ºäº†ä¸€ç‚¹é—®é¢˜ï¼Œä½†æŒ‰æç¤ºæ“ä½œåå†æ‰§è¡Œgem install redis å°±å¥½å•¦(å¦‚ä¸‹å›¾) <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-b0e5017ebdb263d5?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-b0e5017ebdb263d5?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p>ä¸Šé¢çš„æ­¥éª¤å®Œäº‹äº†ï¼Œæ¥ä¸‹æ¥è¿è¡Œä¸€ä¸‹redis-trib.rb</p><p>/usr/local/redis/src/redis-trib.rb  <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-4713e35534e7750b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-4713e35534e7750b?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p>ç¡®è®¤æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨å‚æ•°create åˆ›å»ºé›†ç¾¤</p><p>/usr/local/redis/src/redis-trib.rb  create  â€“replicas  1   127.0.0.1:7000  127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003  127.0.0.1:7004  127.0.0.1:7005 <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-186ca78d50448cb6?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-186ca78d50448cb6?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p><br /></p><br /><p>è§£é‡Šä¸‹ï¼Œ â€“replicas  1  è¡¨ç¤º è‡ªåŠ¨ä¸ºæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªslaveèŠ‚ç‚¹    ä¸Šé¢æœ‰6ä¸ªèŠ‚ç‚¹ï¼Œç¨‹åºä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™ç”Ÿæˆ 3ä¸ªmasterï¼ˆä¸»ï¼‰3ä¸ªslave(ä»)</p><p>ps:é˜²ç«å¢™ä¸€å®šè¦å¼€æ”¾ç›‘å¬çš„ç«¯å£ ï¼Œå¦åˆ™ä¼šåˆ›å»ºå¤±è´¥ã€‚ <br /> è¿è¡Œä¸­ï¼Œæç¤ºCan I setthe above configuration? (typeâ€™yesâ€™to accept): yes    //è¾“å…¥yes  <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-004ab72095f499d7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-004ab72095f499d7?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p>okï¼ŒæŸ¥çœ‹ä¸€ä¸‹ /usr/local/redis/src/redis-trib.rb check 127.0.0.1:7000  <br /></p><div class="image-package">
<img alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" src="http://upload-images.jianshu.io/upload_images/2556999-b7907a0f696b516d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2556999-b7907a0f696b516d?imageMogr2/auto-orient/strip" /><br /><div class="image-caption"></div>
</div><p><br /></p><br /><p>å¯ä»¥ä»å›¾ä¸­çœ‹åˆ°7000,7002è¢«é€‰ä¸ºmasteräº†</p><p>è‡³æ­¤ï¼Œé›†ç¾¤å·²ç»åˆæ­¥æ­å»ºå¥½äº†ã€‚</p><h2>
<a target="_blank"></a>5. æµ‹è¯•</h2><p>1ï¼‰get å’Œ setæ•°æ®</p><p>redis-cli -c -p 7000</p><p>è¿›å…¥å‘½ä»¤çª—å£ï¼Œç›´æ¥ set   wb  wudalang_gd</p><p>ç›´æ¥æ ¹æ®hashåŒ¹é…åˆ‡æ¢åˆ°ç›¸åº”çš„slotçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>è¿˜æ˜¯è¦è¯´æ˜ä¸€ä¸‹ï¼Œredisé›†ç¾¤æœ‰16383ä¸ªslotç»„æˆï¼Œé€šè¿‡åˆ†ç‰‡åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¯»å†™éƒ½å‘ç”Ÿåœ¨masterèŠ‚ç‚¹ã€‚</p><p>2ï¼‰å®•æœºæµ‹è¯•</p><p>å‡å¦‚æˆ‘ä»¬æŠŠä¸Šé¢çš„masterä¸º7000æˆ–7002çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹downæ‰ï¼Œå¤§å®¶å¯ä»¥å†å»çœ‹ä¸€ä¸‹å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œä¾ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä¼šæœ‰æ–°çš„ä»èŠ‚ç‚¹å˜ä¸ºmasterï¼Œé›†ç¾¤ä¾ç„¶èƒ½ç»§ç»­å·¥ä½œã€‚</p><p>åŸå› ï¼š  redisé›†ç¾¤  é€šè¿‡é€‰ä¸¾æ–¹å¼è¿›è¡Œå®¹é”™ï¼Œä¿è¯ä¸€å°ServeræŒ‚äº†è¿˜èƒ½è·‘ï¼Œè¿™ä¸ªé€‰ä¸¾æ˜¯å…¨éƒ¨é›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„Masterå‘ç°å…¶ä»–MasteræŒ‚äº†åï¼Œä¼šå°†å…¶ä»–å¯¹åº”çš„SlaveèŠ‚ç‚¹å‡çº§æˆMaster.</p><p>PSï¼š è¶…è¿‡åŠæ•°æŒ‚äº†é‚£æ•‘ä¸äº†äº†ï¼Œæ•´ä¸ªé›†ç¾¤å°±æ— æ³•å·¥ä½œäº†ã€‚ <br />3ï¼‰å…³äºä¸€è‡´æ€§ hash <br />ç›®å‰è¿˜æ²¡ä»€ä¹ˆå…¬å¸ç”¨redisæ¥åšæ•°æ®åº“æŒä¹…åŒ–çš„å§ï¼Œæˆ‘ä»¬åªæ˜¯æ‹¿æ¥åšcacheï¼Œå®˜ç½‘è¯´çš„å¾ˆæ¸…æ¥šï¼ŒRedis Cluster is not able to guarantee strong consistency .</p><h1>
<a target="_blank"></a>å†™åœ¨æœ€å</h1><p>ç½‘ä¸Šå…³äºredisé›†ç¾¤çš„èµ„æ–™çœŸçš„æ˜¯å¾ˆä¹±ï¼Œæˆ‘å¾ˆå¤šæ¬¡èµ°å…¥åˆ«äººæŒ–å¾—å‘åŠå¤©çˆ¬ä¸å‡ºæ¥ï¼Œæœ‰çš„äººå±…ç„¶åœ¨redis3.0.0è¿˜æ²¡releaseså°±å¿½æ‚ äºº(æ°”å“­~)ï¼Œä¸è¿‡ï¼Œæˆ‘ç›¸ä¿¡éšç€å®˜æ–¹çš„ä¸æ–­è¿­ä»£æ›´æ–°å’Œå¤§å®¶çš„å…±åŒåŠªåŠ›ï¼ŒRedis Clusterä¸€å®šä¼šé€æ¸å®Œå–„æˆç†Ÿçš„ï¼</p>
        </div>
:ET